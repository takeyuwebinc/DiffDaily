# Project: DiffDaily (MVP)

## 1. 概要と目的
**DiffDaily** は、指定したGitHubリポジトリ（OSS）の変更を定点観測し、LLMを用いて技術者向けの要約記事を自動生成・投稿するブログプラットフォームです。

* **Service Name:** DiffDaily
* **Domain:** diffdaily.dev (予定)
* **Concept:** "Deep & Concise" - コミットログの海から、重要な技術的変更だけを毎日お届けする。

## 2. MVPのスコープ
* **対象:** 単一のリポジトリ（初期設定として `basecamp/kamal` を指定）。
* **頻度:** 日次（Daily Summary）。
* **出力:** Markdown形式の記事をDBに保存し、Web画面で閲覧可能にする。

## 3. 技術スタック
* **Language/Framework:** Ruby on Rails 8.x
* **Database:** SQLite (本番はLitestream等で管理想定)
* **Job Queue:** Solid Queue
* **CSS Framework:** TailwindCSS
* **LLM API:** OpenAI API (GPT-4o) or Anthropic API (Claude 3.5 Sonnet)
* **Git Interface:** Octokit (GitHub API Client)

## 4. システムアーキテクチャ

### コンポーネント
1.  **GitHub Watcher (Job):**
    * 指定リポジトリの過去24時間の `Commits` と関連する `Pull Requests` を取得。
    * ノイズ（Docs修正、Typo修正、CI設定など）を簡易フィルタリング。
2.  **Content Generator (Service):**
    * 取得した `Diff` と `PR Description` をLLMに渡し、日本語記事を生成。
    * システムプロンプトによる厳密なフォーマット制御を行う。
3.  **Web UI (View):**
    * **Header:** "DiffDaily" のロゴ（テキスト）を表示。
    * **Index:** 日付ごとの要約一覧。
    * **Show:** 記事詳細。記事末尾に「AI生成」のメタデータと免責事項を表示。

## 5. データモデル設計

* **Repositories**
    * name (string): e.g., "basecamp/kamal"
    * url (string)
* **Posts**
    * repository_id (references)
    * title (string)
    * body (text): 生成されたMarkdown
    * source_url (string): PRやCommitへのリンク
    * generated_by (string): 使用したモデル名 (e.g., "GPT-4o")
    * published_at (datetime)
    * status (enum): draft / published / skipped

## 6. コアロジック: AIプロンプト設計

LLMへのリクエストには以下のシステムプロンプトを使用すること。

~~~text
# Role
あなたは「DiffDaily」の専属ライターです。熟練したインフラエンジニアとして、OSSの変更内容を技術者向けに深く、かつ簡潔に解説します。

# Goal
入力されたGitHubの「Pull Request情報」と「Diff（差分）」をもとに、その変更の要点をまとめた日本語の記事を作成してください。

# Guidelines (DiffDaily Style)
1. **Title**: 「[Repo名] 変更内容の要約」という形式。
2. **Context**: なぜその変更が必要だったのか（解決された課題）を、PRのDescriptionから読み取って冒頭で解説する。
3. **Technical Detail**: 具体的にコードや設定がどう変わったか、技術的な視点で解説する。「こう書けるようになった」というExampleコードがあれば提示する。
4. **Target Audience**: 専門知識を持つエンジニア向け。事実とコードを中心に構成する。
5. **Filtering**: 以下の場合は記事を作成せず、ただ "SKIP" とだけ出力すること。
    - 単なるライブラリのバージョンアップ（Dependabotなど）
    - READMEやドキュメントのみの修正
    - CI（GitHub Actions）の設定変更のみ

# Output Format (Markdown)
記事の末尾には必ず以下のメタデータブロックを挿入すること。
---
* **Primary Source**: [PR #{number}]({url})
* **Generated by**: {model_name} for DiffDaily
~~~

## 7. 実装ステップ（Claude Codeへの指示）

以下の順序で実装を進めてください。

1.  **Rails Setup:** Rails 8の新規プロジェクト `diff_daily` を作成（Solid Queue, TailwindCSS等の基本設定）。
2.  **Models:** `Repository`, `Post` モデルの作成とマイグレーション。
3.  **GitHub Service:** `Octokit` を使い、特定リポジトリのPRとDiffを取得するサービスクラスの実装。
4.  **LLM Service:** `ruby-openai` (または `anthropic`) gemを使い、上記プロンプトを用いて要約を生成するサービスクラスの実装。
5.  **Job:** これらを繋ぎ合わせる `DailySummaryJob` の実装。
6.  **UI:** 記事一覧と詳細を表示するViewの実装。ヘッダーには `DiffDaily` と表示すること。

## 8. 環境変数
開発には以下の`.env`が必要。
* `GITHUB_ACCESS_TOKEN`
* `OPENAI_API_KEY` (or `ANTHROPIC_API_KEY`)
