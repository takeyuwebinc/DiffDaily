# DiffDaily 要件定義書

**作成日**: 2026年1月7日
**更新日**: 2026年1月7日

## 1. 機能概要

DiffDailyは、GitHubのOSSリポジトリにおける技術的変更を定点観測し、AIを用いて技術者向けの要約記事を自動生成・公開するブログプラットフォームである。

**解決する課題**：
- OSSの技術的変更を追跡するのが困難
- 英語のPull Requestから重要な技術変更を読み取るのに時間がかかる
- 日本語での技術解説が不足している

**主要な提供価値**：
- OSS開発者・利用者が重要な技術変更を効率的にキャッチアップできる
- Pull Requestの差分から本質的な変更内容を抽出し、日本語で解説
- 継続的な情報発信による技術コミュニティへの貢献

**コンセプト**: "Deep & Concise" - コミットログの海から、重要な技術的変更だけを毎日お届けする。

## 2. 機能要件

### 2.1 基本処理フロー

1. **GitHub リポジトリ監視**
   - 指定したGitHubリポジトリの過去24時間のPull Requestsを取得する
   - マージされたPull Requestsのみを対象とする
   - PR番号、タイトル、説明、URL、マージ日時、ファイル差分を取得する
   - 以下のノイズを自動フィルタリングする：
     - 依存関係の自動更新（Dependabot等）
     - ドキュメントのみの修正
     - CI設定のみの変更

2. **AI記事自動生成**
   - Pull Request情報を基に、AIで技術記事を生成する
   - 記事には以下の要素を含める：
     - 変更の背景・解決された課題
     - 技術的な詳細
     - コード例（可能な場合）
     - 出典情報（PR番号、URL）
   - フィルタリング条件に該当する場合は記事を生成せずスキップする
   - 記事末尾にAI生成である旨のメタデータを付与する

3. **記事管理**
   - 生成された記事をデータベースに保存する
   - 記事のステータスを管理する（draft / published / skipped）
   - タイトル、本文、出典URL、生成モデル名、公開日時を記録する
   - リポジトリとの関連付けを行う

4. **Web UI - 記事閲覧**
   - 公開済み記事を一覧表示する
   - 公開日時の降順で表示する
   - 各記事にタイトル、公開日時、リポジトリ名を表示する
   - 個別記事の詳細ページを提供する
   - 記事本文はMarkdown形式で表示する
   - AI生成に関する免責事項を表示する

5. **日次バッチ処理**
   - 定期的に監視・記事生成を実行する
   - リポジトリを指定してジョブを実行できる
   - エラー発生時はログに記録する
   - 手動でも実行可能とする

### 2.2 データ仕様

- **リポジトリ情報**：
  - リポジトリ名（owner/repo形式）
  - リポジトリURL

- **記事情報**：
  - タイトル
  - 本文（Markdown形式）
  - 出典URL
  - 生成したAIモデル名
  - 公開日時
  - ステータス

### 2.3 エラー処理

- **エラー条件**：
  - GitHub APIアクセス失敗：エラーをログに記録
  - AI API呼び出し失敗：エラーをログに記録
  - 記事生成のスキップ：スキップをログに記録
- **エラー通知**：
  - エラー発生時はログに記録する

## 3. 前提条件・制約事項

### 3.1 前提条件

- **システム前提条件**：
  - GitHubパブリックリポジトリへのAPIアクセスが可能であること
  - AI API（Anthropic）へのアクセスが可能であること
  - 必要なAPIトークンが取得・設定されていること

- **データ前提条件**：
  - 監視対象リポジトリが事前に登録されていること
  - 初期設定として `basecamp/kamal` を登録する

### 3.2 制約事項

- **MVP期間の制約**：
  - 監視対象は単一リポジトリのみ
  - 公開リポジトリのみ対応
  - 管理画面なし（Railsコンソールで操作）
  - ユーザー認証機能なし
  - 記事の手動編集機能なし

- **外部システム連携**：
  - GitHub API：Pull Request情報の取得
  - Anthropic API：記事生成

### 3.3 依存関係

- GitHub APIの可用性
- Anthropic APIの可用性
- インターネット接続

## 4. 用語定義

| 用語 | 説明 |
|------|------|
| DiffDaily | 本プロジェクト名。GitHubの差分を日次で監視・記事化するサービス |
| Pull Request (PR) | GitHubでのコード変更提案・レビューの単位 |
| Diff | コードの差分。変更前後の比較 |
| マージ | Pull Requestの変更をメインブランチに統合すること |

## 5. 受け入れ条件

- [ ] 指定したリポジトリのマージ済みPRを取得できること
- [ ] ノイズ（Dependabot、ドキュメントのみ、CI設定のみ）をフィルタリングできること
- [ ] PRの情報からAIで技術記事を生成できること
- [ ] 記事が適切なフォーマットで生成されること
- [ ] フィルタリング対象の変更はスキップされること
- [ ] 生成された記事がデータベースに保存されること
- [ ] 記事一覧ページで公開済み記事が表示されること
- [ ] 記事詳細ページで記事本文が表示されること
- [ ] AI生成の免責事項が表示されること
- [ ] 日次バッチジョブが実行できること
- [ ] エラー発生時にログが記録されること

## 6. 今後の拡張予定

### ファーストリリース（今回対象）
- 単一リポジトリ（basecamp/kamal）の監視
- AI記事自動生成
- 記事一覧・詳細の表示

### セカンドリリース以降
- 複数リポジトリ対応
- RSS/Atom フィード
- 記事のタグ付け・カテゴリ分類
- ユーザー登録・購読機能
- メール配信
- 記事の手動編集機能

---

## 改訂履歴

| バージョン | 日付 | 変更内容 |
|------------|------|----------|
| 1.0 | 2026/01/07 | 初版作成 |
