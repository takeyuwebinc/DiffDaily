# Google Analytics導入 要件定義書

**作成日**: 2026年1月10日
**更新日**: 2026年1月10日

## 1. 機能概要

DiffDailyにGoogle Analytics 4（GA4）を導入し、ユーザーの流入元とページビューを計測する。

**主要な提供価値**：
- ユーザーの流入元（検索エンジン、SNS、直接アクセス等）を把握できる
- 各ページのアクセス状況を可視化できる

## 2. 機能要件

### 2.1 ページビュー計測

- すべてのページでページビューを計測する
- Turbo（Hotwire）によるページ遷移も正しく計測する

### 2.2 流入元トラッキング

- GA4標準の流入元トラッキングを利用する
  - 検索エンジン経由
  - SNS経由
  - リファラル（他サイトからのリンク）
  - 直接アクセス

### 2.3 計測対象ページ

- トップページ（記事一覧）
- 記事詳細ページ
- その他すべての公開ページ

## 3. 前提条件・制約事項

### 3.1 前提条件

- Google Analytics 4プロパティが作成済みであること

### 3.2 制約事項

- Turbo Driveによるページ遷移に対応すること（SPA的な動作への対応）
- 測定IDは環境変数で設定可能であること（Kamalデプロイに対応）

## 4. 対象外

以下は本要件の対象外とする：

- カスタムイベントトラッキング（リンククリック、コードコピー等）
- eコマーストラッキング
- ユーザー属性のカスタム設定
- Cookie同意バナーの実装

## 5. 用語定義

| 用語 | 説明 |
|------|------|
| GA4 | Google Analytics 4。Googleが提供するウェブ解析サービスの最新版 |
| 測定ID | GA4プロパティを識別する一意のID（G-XXXXXXXXXXの形式） |
| Turbo Drive | Hotwireの一部。ページ遷移を高速化するためにAjaxでページを読み込む仕組み |
| ページビュー | ユーザーがページを閲覧した回数 |

## 6. 受け入れ条件

- [ ] GA4のリアルタイムレポートにアクセスが記録されること
- [ ] トップページから記事詳細ページへの遷移がページビューとして計測されること
- [ ] ブラウザの戻る・進むボタンでの遷移もページビューとして計測されること
- [ ] 流入元（参照元/メディア）がGA4レポートで確認できること
- [ ] 測定IDが環境変数から設定されること
- [ ] 測定IDが未設定の場合、GA4スクリプトが出力されないこと

---

## 改訂履歴

| バージョン | 日付 | 変更内容 |
|------------|------|----------|
| 1.0 | 2026/01/10 | 初版作成 |
