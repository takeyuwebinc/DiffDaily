# 要件定義書: AI生成記事品質レビューシステム

**文書バージョン**: 1.2
**作成日**: 2026-01-07
**プロジェクト名**: DiffDaily
**対象機能**: AI生成記事の品質レビュー機能

---

## 1. 文書の目的

本文書は、DiffDailyにおけるAI生成記事の品質レビュー機能の要件を定義する。

---

## 2. 背景と課題

### 2.1 現状の課題

- **AI生成記事の品質担保の問題**
  - GitHubのPR情報から自動生成される技術記事について、ハルシネーション（事実に基づかない内容）を検出できない
  - 記事の正確性や品質を人手で確認する仕組みがない
  - 読者にとって、生成された記事の信頼性が不明確

### 2.2 解決したい課題

- AI生成記事の品質を自動的に評価し、一定の基準を満たすことを保証する
- 記事の読者に対して、品質評価の根拠を透明性を持って提示する
- 品質の低い記事を自動的に改善または排除する

---

## 3. システム概要

### 3.1 システムの目的

AI生成記事に対して、別のAIモデルによる品質レビューを実施し、評価結果を記録・表示することで、記事の信頼性を担保する。

### 3.2 対象ユーザー

- **主要ユーザー**: 記事の読者（エンジニア）
- **副次ユーザー**: システム管理者

---

## 4. 機能要件

### 4.1 品質レビューの実施

#### FR-01: 記事生成時の自動レビュー

**優先度**: Must have

システムは、記事生成時に自動的に品質レビューを実施する。

**受入基準**:
- 記事生成完了後、自動的にレビュープロセスが開始される
- レビュー完了まで記事の公開処理が待機する

#### FR-02: 複数観点による評価

**優先度**: Must have

システムは、以下の3つの観点で記事を評価する：

1. **ガイドライン準拠**: 記事構成とDiffDaily Styleへの準拠状況
2. **技術的整合性**: 技術的な正確性と表現の適切性
3. **PR内容との整合性**: 元のPR情報との一致度

**受入基準**:
- 各観点について、個別に評価が行われる
- 各観点の評価結果が記録される

#### FR-03: 評価結果のステータス判定

**優先度**: Must have

システムは、各観点について以下のステータスを判定する：

- **PASS**: 問題なし
- **WARNING**: 改善推奨（公開は可能）
- **FAIL**: 修正必須

**受入基準**:
- 各観点のステータスが明確に判定される
- ステータスに応じた処理が実行される

#### FR-04: 評価フィードバックの記録

**優先度**: Must have

システムは、各観点の評価について、問題がない場合でも具体的なフィードバックを記録する。

**受入基準**:
- 問題がない場合は、良い点や評価ポイントが記録される
- 問題がある場合は、具体的な問題内容が記録される

### 4.2 記事の自動改善

#### FR-05: 品質不足時の自動リトライ

**優先度**: Must have

システムは、レビュー結果が不合格の場合、記事を自動的に再生成して再評価する。

**受入基準**:
- レビュー不合格時、修正指示を含めて記事を再生成する
- 最大2回まで再生成を試行する

#### FR-06: リトライ上限到達時の処理

**優先度**: Must have

システムは、リトライ上限に達した場合でも、記事を「問題ありだが承認」として公開する。

**受入基準**:
- リトライ上限到達時、記事は公開される
- 公開時のステータスは「approved_with_issues」として記録される

### 4.3 レビュー結果の記録

#### FR-07: レビューステータスの記録

**優先度**: Must have

システムは、以下のレビューステータスを記録する：

- **not_reviewed**: 精査未実施
- **approved**: 1回目で承認
- **approved_with_retry**: リトライ後に承認
- **approved_with_issues**: 問題ありだが上限到達後に承認

**受入基準**:
- レビュー完了時、適切なステータスが記録される

#### FR-08: レビュー詳細情報の記録

**優先度**: Must have

システムは、以下の情報を記録する：

- レビュー実施回数
- レビューを実施したAIモデル名
- 各観点の評価結果（ステータス、フィードバック）
- 検出された問題の詳細（カテゴリ、重要度、説明、修正提案）
- 総合的なフィードバック

**受入基準**:
- すべての情報が構造化されたJSON形式で記録される

#### FR-09: 問題情報の構造化記録

**優先度**: Must have

システムは、検出された問題について以下の情報を記録する：

- **カテゴリ**: guideline / technical / pr_consistency
- **重要度**: critical（修正必須） / warning（改善推奨）
- **説明**: 問題の具体的な説明
- **修正提案**: 改善のための提案

**受入基準**:
- 各問題について、すべての項目が記録される

### 4.4 レビュー結果の表示

#### FR-10: レビューステータスの表示

**優先度**: Must have

システムは、記事詳細ページにレビューステータスを表示する。

**受入基準**:
- レビューステータスがバッジ形式で視覚的に表示される
- レビュー実施回数が表示される

#### FR-11: レビュワー情報の表示

**優先度**: Must have

システムは、レビューを実施したAIモデル名を表示する。

**受入基準**:
- 「Reviewed by: [モデル名] for DiffDaily」形式で表示される
- 記事生成モデルと同じ書式で表示される

#### FR-12: レビュー観点と評価結果の表示

**優先度**: Must have

システムは、各レビュー観点について以下を表示する：

- 観点名と説明
- 評価ステータス（PASS/WARNING/FAIL）
- 具体的なフィードバック
- サブ観点のリスト

**受入基準**:
- 各観点が個別のカードとして表示される
- ステータスに応じた色分けが行われる（緑/黄/赤）
- フィードバックが読みやすい形式で表示される

#### FR-13: 検出された問題の表示

**優先度**: Must have

システムは、「approved_with_issues」ステータスの記事について、検出された問題の詳細を表示する。

**受入基準**:
- 問題が存在する場合のみ、問題セクションが表示される
- 各問題のカテゴリ、重要度、説明、修正提案が表示される
- 重要度に応じたアイコンが表示される

#### FR-14: 品質担保の注記表示

**優先度**: Must have

システムは、問題が検出されても公開された記事について、注記を表示する。

**受入基準**:
- 「上記の問題は検出されましたが、記事は公開基準を満たしています」という注記が表示される

---

## 5. 制約条件

### 5.1 技術的制約

- 記事生成には Claude Sonnet 4.5 を、レビューには Gemini 2.5 Pro を使用する
- レビュープロセスは記事生成の一部として同期的に実行される
- レビュー失敗時は、記事を承認として扱う（システムの可用性を優先）

### 5.2 業務的制約

- リトライは最大2回まで
- レビュー観点は3つに固定（拡張性は考慮しない）

---

## 6. 用語定義

| 用語 | 定義 |
|------|------|
| 品質レビュー | AIモデルによる記事の自動評価プロセス |
| レビュー観点 | 記事を評価する際の視点（ガイドライン準拠、技術的整合性、PR内容との整合性） |
| レビューステータス | レビュー結果の状態を示す値 |
| リトライ | レビュー不合格時の記事再生成・再評価プロセス |
| ハルシネーション | AIが事実に基づかない内容を生成する現象 |

---

## 7. 対象外事項

以下の項目は本機能の対象外とする：

- 人手によるレビューワークフロー
- レビュー観点のカスタマイズ機能
- レビュー履歴の管理・比較機能
- レビュー基準の動的変更機能
- パフォーマンス要件（レビュー時間の上限等）
- レビュー結果に基づく記事の自動修正機能

---

## 8. 補足事項

### 8.1 レビューモデルの選定

記事生成とレビューに異なるモデルを使用する理由：

- **多角的な品質評価**: 異なるモデルを使用することで、バイアスの軽減と多様な視点からのレビューが可能になる
- **独立性の担保**: 生成元とは異なるモデルによるレビューにより、より客観的な評価が期待できる
- **ハルシネーション検出の向上**: 異なるアーキテクチャのモデルが相互にチェックすることで、ハルシネーションの検出精度が向上する

### 8.2 ハルシネーション検出の限界

本システムは、AIによる自動レビューであるため、完全なハルシネーション検出は保証されない。以下の点に留意する：

- レビューAI自身もハルシネーションを起こす可能性がある
- 技術的な正確性の最終確認は読者に委ねられる
- レビュー結果は「参考情報」として位置づけられる

### 8.3 表示形式の統一

レビュー結果の表示は、記事メタデータセクションと同じ体裁で統一する：

- ラベルは英語表記（Review Status, Reviewed by等）
- パディング、フォントサイズは他セクションと同一
- レビュワー情報は記事生成モデルと同じ書式

---

## 9. 参照ドキュメント

- DiffDaily スタイルガイド: `app/actions/content/generate_article.rb` (SYSTEM_PROMPT)
- データベーススキーマ: `db/schema.rb`
- レビュープロンプト: `app/actions/content/generate_article.rb` (REVIEW_PROMPT)

---

## 変更履歴

| バージョン | 日付 | 変更内容 | 作成者 |
|-----------|------|----------|--------|
| 1.0 | 2026-01-07 | 初版作成 | - |
| 1.1 | 2026-01-07 | レビューモデルをGemini 3 Proに変更、選定理由を追加 | - |
| 1.2 | 2026-01-07 | レビューモデルをGemini 2.5 Proに変更（Gemini 3 ProはAPI未対応のため） | - |
