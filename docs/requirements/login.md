# 要件定義書：ログイン機能

## 1. 概要

### 1.1 目的

DiffDailyに管理機能を追加するため、特定ドメインのGoogleアカウントによるログイン機能を実装する。

### 1.2 背景

現在のDiffDailyは認証機能がなく、リポジトリの登録などの管理操作を行う手段がない。管理機能を保護しつつ、社内メンバーが利用できるようにする必要がある。

### 1.3 スコープ

| 対象 | 内容 |
|------|------|
| 対象 | 管理画面へのログイン機能 |
| 対象外 | 一般公開画面（投稿一覧・詳細）の認証 |
| 対象外 | MCP/APIサーバー向けOAuth（Doorkeeper） |

## 2. ステークホルダー

| ステークホルダー | 役割 | 関心事 |
|------------------|------|--------|
| 社内メンバー | 管理者 | リポジトリの登録・管理 |
| 一般ユーザー | 閲覧者 | 投稿の閲覧（認証不要） |

## 3. 機能要件

### 3.1 ログイン機能

#### FR-001: Google OAuth2によるログイン

- ユーザーはGoogleアカウントを使用して管理画面にログインできる
- `@takeyuweb.co.jp` ドメインのアカウントのみログインを許可する
- 許可されていないドメインのアカウントでログインを試みた場合、エラーメッセージを表示してログインを拒否する

#### FR-002: セッション管理

- ログイン成功後、ユーザーのセッションを維持する
- ユーザーは任意のタイミングでログアウトできる

### 3.2 認可（アクセス制御）

#### FR-003: 管理画面の保護

- 管理画面（`/admin/*`）はログイン済みユーザーのみアクセス可能とする
- 未ログイン状態で管理画面にアクセスした場合、ログイン画面にリダイレクトする
- ログイン後、元々アクセスしようとしていた画面にリダイレクトする

#### FR-004: 公開画面のアクセス

- 一般公開画面（投稿一覧・詳細）は認証不要でアクセス可能とする

### 3.3 管理機能

#### FR-005: リポジトリ管理

- ログイン済みユーザーは、監視対象のGitHubリポジトリを登録できる
- ログイン済みユーザーは、登録済みリポジトリの一覧を確認できる
- ログイン済みユーザーは、登録済みリポジトリを削除できる

## 4. 制約条件

### 4.1 技術的制約

- 参照実装: https://github.com/takeyuwebinc/rails-spotlight/commit/a05f8b55ea115f41fccd1d4f1cb3ed5e0fccdd8a
- OmniAuth + omniauth-google-oauth2 を使用する

### 4.2 ビジネス制約

- `@takeyuweb.co.jp` ドメインのGoogleアカウントのみ利用可能
- ドメインが一致すれば、事前のユーザー登録なしでログイン可能

## 5. 用語定義

| 用語 | 定義 |
|------|------|
| 管理画面 | ログイン必須の管理機能を提供する画面群（`/admin/*`） |
| 公開画面 | 認証不要でアクセス可能な画面（投稿一覧・詳細） |
| 許可ドメイン | `@takeyuweb.co.jp` |

## 6. 参考資料

- [参照実装（rails-spotlight）](https://github.com/takeyuwebinc/rails-spotlight/commit/a05f8b55ea115f41fccd1d4f1cb3ed5e0fccdd8a)
