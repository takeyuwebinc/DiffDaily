# リポジトリ別記事一覧機能設計書

**機能名**: リポジトリ別記事一覧機能
**バージョン**: 1.0
**作成日**: 2026年1月10日
**更新日**: 2026年1月10日

## 1. 機能概要

### 1.1 目的

- 特定のリポジトリに紐づく記事のみを一覧表示する
- リポジトリ単位での記事閲覧を可能にする
- 興味のあるリポジトリの更新情報を効率的に追跡できるようにする

### 1.2 主要機能

1. **リポジトリ別記事一覧表示**: 指定リポジトリの公開済み記事を一覧表示する
2. **トップページからの導線**: トップページにリポジトリ一覧を表示し、各リポジトリの記事一覧へ遷移可能にする
3. **記事詳細からの導線**: 記事詳細ページのリポジトリ名から記事一覧へ遷移可能にする

### 1.3 処理フロー概要

#### 1.3.1 リポジトリ別記事一覧の表示

1. URLからリポジトリ識別子を取得する
2. 該当リポジトリを検索し、存在しない場合は404エラーを返す
3. 該当リポジトリに紐づく公開済み記事を取得する
4. 公開日時の降順でソートし、ページネーションを適用する
5. 記事一覧を表示する

#### 1.3.2 トップページへのリポジトリ一覧追加

1. 公開済み記事を持つリポジトリを取得する
2. 各リポジトリの公開済み記事数を集計する
3. リポジトリ一覧を記事一覧の上部に表示する

#### 1.3.3 記事詳細からの導線追加

1. 既存のリポジトリ名表示をリンク化する
2. クリック時にリポジトリ別記事一覧へ遷移する

## 2. データ要件

### 2.1 既存テーブル（変更なし）

#### 2.1.1 リポジトリ
**テーブル名**: `repositories`

| 項目名 | キー | データ型 | 必須 | 説明 |
|--------|------|----------|------|------|
| id | PK | bigint | ○ | 主キー |
| name | UK | varchar | ○ | リポジトリ名（一意） |
| url | | varchar | ○ | GitHubリポジトリURL |
| last_fetched_at | | datetime | | 最終PR取得日時 |
| created_at | | datetime | ○ | 作成日時 |
| updated_at | | datetime | ○ | 更新日時 |

#### 2.1.2 記事
**テーブル名**: `posts`

| 項目名 | キー | データ型 | 必須 | 説明 |
|--------|------|----------|------|------|
| id | PK | bigint | ○ | 主キー |
| repository_id | FK | bigint | ○ | リポジトリID |
| title | | varchar | ○ | 記事タイトル |
| body | | text | ○ | 記事本文 |
| summary | | text | | 記事の要約 |
| status | | varchar | ○ | 公開状態（draft/published/skipped） |
| published_at | | datetime | | 公開日時 |
| created_at | | datetime | ○ | 作成日時 |
| updated_at | | datetime | ○ | 更新日時 |

**制約**:
- FOREIGN KEY(repository_id) REFERENCES repositories(id)

## 3. ビジネスルール

### 3.1 表示対象

#### 3.1.1 記事の表示条件
- statusが「published」の記事のみを表示対象とする
- draft、skippedの記事は表示しない

#### 3.1.2 リポジトリ一覧の表示条件
- 公開済み記事を1件以上持つリポジトリのみを一覧に表示する
- 記事が存在しないリポジトリは一覧に表示しない

### 3.2 ソート順

#### 3.2.1 記事一覧のソート
- 公開日時（published_at）の降順で表示する
- 新しい記事が上に表示される

### 3.3 ページネーション

#### 3.3.1 1ページあたりの表示件数
- 既存のトップページと同様の件数を適用する

## 4. 画面表示機能

### 4.1 画面構成

#### 4.1.1 リポジトリ別記事一覧ページ
- **ヘッダー領域**: リポジトリ名、GitHubリポジトリへのリンク、トップページへの戻りリンク
- **記事一覧領域**: 既存のトップページと同様の記事カード形式
- **ページネーション領域**: ページ送りナビゲーション

#### 4.1.2 トップページ（変更）
- **リポジトリ一覧領域**: 記事一覧の上部に配置
- **記事一覧領域**: 既存の全記事一覧（変更なし）

#### 4.1.3 記事詳細ページ（変更）
- リポジトリ名をリンク化（クリックでリポジトリ別記事一覧へ遷移）

### 4.2 リポジトリ一覧仕様

#### 4.2.1 表示項目
- **リポジトリ名**: リポジトリ別記事一覧へのリンクとして表示
- **記事数**: 該当リポジトリの公開済み記事数

### 4.3 エラーハンドリング

#### 4.3.1 エラー分類
| エラーレベル | 説明 | 処理 |
|-------------|------|------|
| NOT_FOUND | 存在しないリポジトリIDが指定された | 404エラーページを表示 |

## 5. ルーティング

### 5.1 追加ルート

| パス | 機能 |
|------|------|
| /repositories/:id/posts | リポジトリ別記事一覧 |

### 5.2 既存ルート（変更なし）

| パス | 機能 |
|------|------|
| / | トップページ（全記事一覧） |
| /posts/:id | 記事詳細 |

---

**関連資料**:
- [リポジトリ別記事一覧機能 要件定義書](../requirements/repository-posts-list.md)
